    if (use_ethernet) {
        ESP_LOGI(TAG, "Network mode: Ethernet - Initializing...");
        // Try to init Ethernet
        ethernet_init(&GLOBAL_STATE);
        ESP_LOGI(TAG, "DEBUG: After ethernet_init, eth_available = %d", GLOBAL_STATE.ETHERNET_MODULE.eth_available);

        // Wait for Ethernet to get IP and update is_connected flag
        if (GLOBAL_STATE.ETHERNET_MODULE.eth_available) {
            ESP_LOGI(TAG, "Waiting for Ethernet IP address...");
            int retry_count = 0;
            while (retry_count < 100) {  // Wait up to 10 seconds
                ethernet_update_status(&GLOBAL_STATE);
                if (GLOBAL_STATE.SYSTEM_MODULE.is_connected) {
                    ESP_LOGI(TAG, "Ethernet connected with IP: %s", GLOBAL_STATE.ETHERNET_MODULE.eth_ip_addr_str);
                    break;
                }
                vTaskDelay(100 / portTICK_PERIOD_MS);
                retry_count++;
            }
            if (!GLOBAL_STATE.SYSTEM_MODULE.is_connected) {
                ESP_LOGW(TAG, "Ethernet timeout, falling back to WiFi");
                wifi_init(&GLOBAL_STATE);
            }
        } else {
            ESP_LOGW(TAG, "Ethernet unavailable, initializing WiFi fallback");
            wifi_init(&GLOBAL_STATE);
        }
    } else {